{"version":3,"sources":["pages/SendToMars/SendToMars.module.css","pages/SendToMars/SendToMars.js"],"names":["module","exports","SendToMars","client","useContext","ClientContext","data","items","useQuery","sentToMarsQuery","getSentToMars","cache","useQueryCache","send","isLoadingSend","useMutation","item","sendToMars","onMutate","cancelQueries","snapshot","getQueryData","setQueryData","prev","id","Math","random","onError","onSettled","invalidateQueries","cancel","isLoading","isLoadingCancel","cancelSendingToMars","filter","x","isPending","className","cs","content","onSubmit","e","preventDefault","FormData","target","keys","Object","fromEntries","map","key","get","pick","disabled","form","required","type","name","defaultValue","value","length","console","log","style","color","important","onClick"],"mappings":"qGACAA,EAAOC,QAAU,CAAC,QAAU,4BAA4B,MAAQ,0BAA0B,KAAO,2B,iGC6GlFC,UAtGI,KACjB,IAAMC,EAASC,qBAAWC,MAClBC,KAAMC,GAAUC,YAASC,KAAiB,IAChDN,EAAOO,kBAEHC,EAAQC,eACPC,GAAM,cAAEC,IAAmBC,aAC/BC,GAASb,EAAOc,WAAWD,IAC5B,CACEE,SAAWF,IACTL,EAAMQ,cAAcV,KACpB,IAAMW,EAAWT,EAAMU,aAAaZ,KAKpC,OAJAE,EAAMW,aAAab,KAAkBc,GAAS,IACzCA,EADyC,2BAEvCP,GAFuC,IAEjCQ,GAAIC,KAAKC,cAEf,IAAMf,EAAMW,aAAab,IAAiBW,IAEnDO,YACAC,UAAW,KACTjB,EAAMkB,kBAAkBpB,SASvBqB,GAAUC,UAAWC,IAAqBjB,aAC9CC,GAASb,EAAO8B,oBAAoBjB,IACrC,CACEE,SAAWF,IACTL,EAAMQ,cAAcV,KACpB,IAAMW,EAAWT,EAAMU,aAAaZ,KAIpC,OAHAE,EAAMW,aAAab,KAAkBc,GACnCA,EAAKW,QAAQC,GAAMA,EAAEX,KAAOR,EAAKQ,OAE5B,IAAMb,EAAMW,aAAab,IAAiBW,IAEnDO,YACAC,UAAW,KACTjB,EAAMkB,kBAAkBpB,QAIxB2B,EAAYtB,GAAiBkB,EACnC,OACE,0BAASK,UAAWC,IAAGC,QAAvB,UACE,8CACA,kCACE,sBAAMC,SA3BMC,IAChBA,EAAEC,iBACF,IAAMpC,EAAO,IAAIqC,SAASF,EAAEG,QAC5B/B,EA9BS,EAACP,EAAMuC,IAClBC,OAAOC,YAAYF,EAAKG,KAAKC,GAAQ,CAACA,EAAK3C,EAAK4C,IAAID,OA6B7CE,CAAK7C,EAAM,CAAC,OAAQ,QAAS,SAAU,QAAS,gBAwBjD,SACE,2BAAU8C,SAAUhB,EAAWC,UAAWC,IAAGe,KAA7C,UACE,0CACO,uBAAOC,UAAQ,EAACC,KAAK,OAAOC,KAAK,YAExC,2CACQ,uBAAOF,UAAQ,EAACC,KAAK,MAAMC,KAAK,aAExC,4CACS,uBAAOD,KAAK,SAASC,KAAK,cAEnC,2CACQ,uBAAOD,KAAK,QAAQC,KAAK,QAAQC,aAAa,eAEtD,+CACY,uBAAOF,KAAK,WAAWC,KAAK,iBAExC,2CACQ,uBAAOD,KAAK,SAASG,MAAM,mBAKzC,kCACGnD,EAAMoD,OAAS,EACd,qCACE,yDACA,oBAAItB,UAAWC,IAAG/B,MAAlB,SACGA,EAAMyC,KAAKhC,IAIV4C,QAAQC,IAAI7C,GAEV,qBAAkB8C,MAAO,CAAEC,MAAO/C,EAAK+C,OAAvC,UACG/C,EAAKwC,KACLxC,EAAKgD,UAAY,QAAU,IAC5B,wBAAQC,QARI,KACdnC,EAAOd,IAOL,iBAHOA,EAAKQ,YAUtB","file":"static/js/10.d9d50d27.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"SendToMars_content__BYVtj\",\"items\":\"SendToMars_items__3NxkZ\",\"form\":\"SendToMars_form__3TxP7\"};","import React, { useContext } from \"react\";\nimport { useMutation, useQuery, useQueryCache } from \"react-query\";\nimport { ClientContext, onError, sentToMarsQuery } from \"../../constants\";\nimport cs from \"./SendToMars.module.css\";\n\nconst pick = (data, keys) =>\n  Object.fromEntries(keys.map((key) => [key, data.get(key)]));\n\nconst SendToMars = () => {\n  const client = useContext(ClientContext);\n  const { data: items } = useQuery(sentToMarsQuery, () =>\n    client.getSentToMars()\n  );\n  const cache = useQueryCache();\n  const [send, { isLoadingSend }] = useMutation(\n    (item) => client.sendToMars(item),\n    {\n      onMutate: (item) => {\n        cache.cancelQueries(sentToMarsQuery);\n        const snapshot = cache.getQueryData(sentToMarsQuery);\n        cache.setQueryData(sentToMarsQuery, (prev) => [\n          ...prev,\n          { ...item, id: Math.random() },\n        ]);\n        return () => cache.setQueryData(sentToMarsQuery, snapshot);\n      },\n      onError,\n      onSettled: () => {\n        cache.invalidateQueries(sentToMarsQuery);\n      },\n    }\n  );\n  const onSubmit = (e) => {\n    e.preventDefault();\n    const data = new FormData(e.target);\n    send(pick(data, [\"name\", \"phone\", \"weight\", \"color\", \"important\"]));\n  };\n  const [cancel, { isLoading: isLoadingCancel }] = useMutation(\n    (item) => client.cancelSendingToMars(item),\n    {\n      onMutate: (item) => {\n        cache.cancelQueries(sentToMarsQuery);\n        const snapshot = cache.getQueryData(sentToMarsQuery);\n        cache.setQueryData(sentToMarsQuery, (prev) =>\n          prev.filter((x) => x.id !== item.id)\n        );\n        return () => cache.setQueryData(sentToMarsQuery, snapshot);\n      },\n      onError,\n      onSettled: () => {\n        cache.invalidateQueries(sentToMarsQuery);\n      },\n    }\n  );\n  const isPending = isLoadingSend || isLoadingCancel;\n  return (\n    <section className={cs.content}>\n      <h1>Send to Mars</h1>\n      <section>\n        <form onSubmit={onSubmit}>\n          <fieldset disabled={isPending} className={cs.form}>\n            <label>\n              Name <input required type=\"text\" name=\"name\" />\n            </label>\n            <label>\n              Phone <input required type=\"tel\" name=\"phone\" />\n            </label>\n            <label>\n              Weight <input type=\"number\" name=\"weight\" />\n            </label>\n            <label>\n              Color <input type=\"color\" name=\"color\" defaultValue=\"#ffffff\" />\n            </label>\n            <label>\n              Important <input type=\"checkbox\" name=\"important\" />\n            </label>\n            <label>\n              Done? <input type=\"submit\" value=\"send\" />\n            </label>\n          </fieldset>\n        </form>\n      </section>\n      <section>\n        {items.length > 0 ? (\n          <>\n            <h2>Waiting for launch date</h2>\n            <ul className={cs.items}>\n              {items.map((item) => {\n                const onClick = () => {\n                  cancel(item);\n                };\n                console.log(item);\n                return (\n                  <li key={item.id} style={{ color: item.color }}>\n                    {item.name}\n                    {item.important ? \" (!) \" : \" \"}\n                    <button onClick={onClick}>X</button>\n                  </li>\n                );\n              })}\n            </ul>\n          </>\n        ) : (\n          <h2>Queue is empty</h2>\n        )}\n      </section>\n    </section>\n  );\n};\n\nexport default SendToMars;\n"],"sourceRoot":""}